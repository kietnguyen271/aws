<!doctype html><html lang=vi class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.134.3"><meta name=description content><meta name=author content="thienlh@thienlu.com"><link rel=icon href=../../../images/favicon.png type=image/png><title>Blog 3 :: Báo cáo thực tập</title>
<link href=../../../css/nucleus.css?1765252493 rel=stylesheet><link href=../../../css/fontawesome-all.min.css?1765252493 rel=stylesheet><link href=../../../css/hybrid.css?1765252493 rel=stylesheet><link href=../../../css/featherlight.min.css?1765252493 rel=stylesheet><link href=../../../css/perfect-scrollbar.min.css?1765252493 rel=stylesheet><link href=../../../css/auto-complete.css?1765252493 rel=stylesheet><link href=../../../css/atom-one-dark-reasonable.css?1765252493 rel=stylesheet><link href=../../../css/theme.css?1765252493 rel=stylesheet><link href=../../../css/hugo-theme.css?1765252493 rel=stylesheet><link href=../../../css/theme-workshop.css?1765252493 rel=stylesheet><script src=../../../js/jquery-3.3.1.min.js?1765252493></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=../../../vi/3-blogstranslated/3.3-blog3/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=../../../><svg id="Layer_1" data-name="Layer 1" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=../../../js/lunr.min.js?1765252493></script><script type=text/javascript src=../../../js/auto-complete.js?1765252493></script><script type=text/javascript>var baseurl="https://thienluhoan.github.io/workshop-template//vi"</script><script type=text/javascript src=../../../js/search.js?1765252493></script></div><div class=highlightable><ul class=topics><li data-nav-id=/vi/1-worklog/ title="Nhật ký công việc" class=dd-item><a href=../../../vi/1-worklog/><b>1. </b>Nhật ký công việc
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/1-worklog/1.1-week1/ title="Week 2 Worklog" class=dd-item><a href=../../../vi/1-worklog/1.1-week1/><b>1.2. </b>Week 2 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.4-week4/ title="Week 4 Worklog" class=dd-item><a href=../../../vi/1-worklog/1.4-week4/><b>1.4. </b>Week 4 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.7-week7/ title="Week 8 Worklog" class=dd-item><a href=../../../vi/1-worklog/1.7-week7/><b>1.8. </b>Week 8 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.8-week8/ title="Week 8 Worklog" class=dd-item><a href=../../../vi/1-worklog/1.8-week8/><b>1.8. </b>Week 8 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.9-week9/ title="Week 9 Worklog" class=dd-item><a href=../../../vi/1-worklog/1.9-week9/><b>1.9. </b>Week 9 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.2-week2/ title="Worklog Tuần 2" class=dd-item><a href=../../../vi/1-worklog/1.2-week2/><b>1.2. </b>Worklog Tuần 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.10-week10/ title="Week 10 Worklog" class=dd-item><a href=../../../vi/1-worklog/1.10-week10/><b>1.10. </b>Week 10 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.11-week11/ title="Week 11 Worklog" class=dd-item><a href=../../../vi/1-worklog/1.11-week11/><b>1.11. </b>Week 11 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.12-week12/ title="Week 12 Worklog" class=dd-item><a href=../../../vi/1-worklog/1.12-week12/><b>1.12. </b>Week 12 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.3-week3/ title="Week 3 Worklog" class=dd-item><a href=../../../vi/1-worklog/1.3-week3/><b>1.3. </b>Week 3 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.5-week5/ title="Week 5 Worklog" class=dd-item><a href=../../../vi/1-worklog/1.5-week5/><b>1.5. </b>Week 5 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/1-worklog/1.6-week6/ title="Week 6 Worklog" class=dd-item><a href=../../../vi/1-worklog/1.6-week6/><b>1.6. </b>Week 6 Worklog
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/2-proposal/ title=Proposal class=dd-item><a href=../../../vi/2-proposal/><b>2. </b>Proposal
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/ title=Blogs class="dd-item
parent"><a href=../../../vi/3-blogstranslated/><b>3. </b>Blogs
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/3-blogstranslated/3.1-blog1/ title="Blog 1" class=dd-item><a href=../../../vi/3-blogstranslated/3.1-blog1/><b>3.1. </b>Blog 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.2-blog2/ title="Blog 2" class=dd-item><a href=../../../vi/3-blogstranslated/3.2-blog2/><b>3.2. </b>Blog 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/3-blogstranslated/3.3-blog3/ title="Blog 3" class="dd-item
active"><a href=../../../vi/3-blogstranslated/3.3-blog3/><b>3.3. </b>Blog 3
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/4-eventparticipated/ title="Các sự kiện đã tham gia" class=dd-item><a href=../../../vi/4-eventparticipated/><b>4. </b>Các sự kiện đã tham gia
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/4-eventparticipated/4.1-event1/ title="AWS Cloud Day Vietnam - AI Edition 2025" class=dd-item><a href=../../../vi/4-eventparticipated/4.1-event1/><b>4.1. </b>AWS Cloud Day Vietnam - AI Edition 2025
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-eventparticipated/4.2-event2/ title="Khám Phá Agentic AI – Workshop Amazon QuickSuite" class=dd-item><a href=../../../vi/4-eventparticipated/4.2-event2/><b>4.2. </b>Khám Phá Agentic AI – Workshop Amazon QuickSuite
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-eventparticipated/4.3-event3/ title="AWS Cloud Mastery Series #3 - Chuyên sâu về Trụ cột Bảo mật" class=dd-item><a href=../../../vi/4-eventparticipated/4.3-event3/><b>4.3. </b>AWS Cloud Mastery Series #3 - Chuyên sâu về Trụ cột Bảo mật
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-eventparticipated/4.4-event4/ title="AWS Cloud Mastery Series #2 - DevOps trên AWS" class=dd-item><a href=../../../vi/4-eventparticipated/4.4-event4/><b>4.4. </b>AWS Cloud Mastery Series #2 - DevOps trên AWS
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-eventparticipated/4.5-event5/ title="AWS Cloud Mastery Series #1 – AI/ML/GenAI on AWS" class=dd-item><a href=../../../vi/4-eventparticipated/4.5-event5/><b>4.5. </b>AWS Cloud Mastery Series #1 – AI/ML/GenAI on AWS
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/4-eventparticipated/4.6-event6/ title="AWS Cloud Mastery Series #1" class=dd-item><a href=../../../vi/4-eventparticipated/4.6-event6/><b>4.6. </b>AWS Cloud Mastery Series #1
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/5-workshop/ title=Workshop class=dd-item><a href=../../../vi/5-workshop/><b>5. </b>Workshop
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/vi/5-workshop/5.1-introduction/ title="5.1 Introduction" class=dd-item><a href=../../../vi/5-workshop/5.1-introduction/><b>5.1. </b>5.1 Introduction
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.2-perequisites/ title="5.2 Prerequisites" class=dd-item><a href=../../../vi/5-workshop/5.2-perequisites/><b>5.2. </b>5.2 Prerequisites
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.3-setup-cognito/ title="5.3 Setup Cognito" class=dd-item><a href=../../../vi/5-workshop/5.3-setup-cognito/><b>5.3. </b>5.3 Setup Cognito
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.4-setup-lambda/ title="5.4 Setup Lambda" class=dd-item><a href=../../../vi/5-workshop/5.4-setup-lambda/><b>5.4. </b>5.4 Setup Lambda
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.5-setup-api-gateway/ title="5.5 Setup API Gateway" class=dd-item><a href=../../../vi/5-workshop/5.5-setup-api-gateway/><b>5.5. </b>5.5 Setup API Gateway
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.6-setup-rds-database/ title="5.6 Setup RDS Database" class=dd-item><a href=../../../vi/5-workshop/5.6-setup-rds-database/><b>5.6. </b>5.6 Setup RDS Database
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.7-setup-s3-cloudfront/ title="5.7 Setup S3 + CloudFront" class=dd-item><a href=../../../vi/5-workshop/5.7-setup-s3-cloudfront/><b>5.7. </b>5.7 Setup S3 + CloudFront
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.8-setup-vpc-security/ title="Setup VPC & Security" class=dd-item><a href=../../../vi/5-workshop/5.8-setup-vpc-security/><b>5.8. </b>Setup VPC & Security
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.9-monitoring-logging/ title="Monitoring & Logging" class=dd-item><a href=../../../vi/5-workshop/5.9-monitoring-logging/><b>5.9. </b>Monitoring & Logging
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/5-workshop/5.10-cleanup/ title="Cleanup & Cost Optimization" class=dd-item><a href=../../../vi/5-workshop/5.10-cleanup/><b>5.10. </b>Cleanup & Cost Optimization
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/vi/6-self-evaluation/ title="Tự đánh giá" class=dd-item><a href=../../../vi/6-self-evaluation/><b>6. </b>Tự đánh giá
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/vi/7-feedback/ title="Chia sẻ & Đóng góp Ý kiến" class=dd-item><a href=../../../vi/7-feedback/><b>7. </b>Chia sẻ & Đóng góp Ý kiến
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://www.facebook.com/groups/awsstudygroupfcj/><i class='fab fa-facebook'></i> AWS Study Group</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=https://thienluhoan.github.io/workshop-template/3-blogstranslated/3.3-blog3/>English</option><option id=vi value=https://thienluhoan.github.io/workshop-template/vi/3-blogstranslated/3.3-blog3/ selected>Tiếng Việt</option></select><svg id="Capa_1" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0>
</left><left><br><br><b>Last Updated</b><br><i><span id=lastUpdated style=color:orange></span>
</i><script>const today=new Date,formattedDate=today.toLocaleDateString("en-GB");document.getElementById("lastUpdated").textContent=formattedDate</script></left><left><br><br><b>Team</b><br><i><a href=https://www.facebook.com/groups/660548818043427 style=color:orange>First Cloud Journey</a><br></i></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=../../../vi/>Báo cáo thực tập</a> > <a href=../../../vi/3-blogstranslated/>Blogs</a> > Blog 3</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#tổng-quan-giải-pháp>Tổng quan giải pháp</a></li><li><a href=#điều-kiện-tiên-quyết>Điều kiện tiên quyết</a></li></ul><ul><li><a href=#produce-records-to-kafka-topic>Produce records to Kafka topic</a></li><li><a href=#tìm-hiểu-về-amazon-msk-iam-authentication-với-emr-serverless>Tìm hiểu về Amazon MSK IAM authentication với EMR Serverless</a></li><li><a href=#cấu-hình-iam-policy>Cấu hình IAM policy</a></li><li><a href=#các-thư-viện-phụ-thuộc-cần-thiết>Các thư viện phụ thuộc cần thiết</a></li><li><a href=#cấu-hình-spark-streaming-job-cho-amazon-msk-iam-authentication>Cấu hình Spark Streaming job cho Amazon MSK IAM authentication</a></li><li><a href=#xử-lý-dữ-liệu-bằng-emr-serverless-streaming-job-với-amazon-msk-iam-authentication>Xử lý dữ liệu bằng EMR Serverless streaming job với Amazon MSK IAM authentication</a></li><li><a href=#xác-thực-dữ-liệu-trong-athena>Xác thực dữ liệu trong Athena</a></li><li><a href=#clean-up>Clean up</a></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#về-các-tác-giả>Về các tác giả</a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Blog 3</h1><h1 id=xây-dựng-đường-ống-streaming-serverless-bảo-mật-với-amazon-msk-serverless-amazon-emr-serverless-và-iam>Xây dựng đường ống streaming serverless bảo mật với Amazon MSK Serverless, Amazon EMR Serverless và IAM</h1><p><em>by Shubham Purwar, Nitin Kumar, and Prashanthi Chinthala on 02 JUN 2025 in<br><a href=https://aws.amazon.com/athena/>Amazon Athena</a>, <a href=https://aws.amazon.com/emr/>Amazon EMR</a>,<br><a href=https://aws.amazon.com/msk/>Amazon Managed Streaming for Apache Kafka (Amazon MSK)</a>,<br>Analytics, AWS Big Data<br>Permalink • Comments • Share</em></p><p>Sự tăng trưởng theo cấp số nhân và khối lượng khổng lồ của dữ liệu streaming đã khiến nó trở thành một nguồn tài nguyên quan trọng đối với các tổ chức trên toàn thế giới.<br>Để khai thác tối đa tiềm năng này, phân tích thời gian thực (real-time analytics) là yếu tố cần thiết để trích xuất các thông tin có thể hành động (actionable insights).</p><p>Được tạo ra từ nhiều nguồn khác nhau, bao gồm mạng xã hội, cảm biến Internet of Things (IoT) và tương tác của người dùng, dữ liệu streaming giúp doanh nghiệp phản ứng nhanh với các xu hướng và sự kiện mới, đưa ra quyết định sáng suốt, và duy trì lợi thế cạnh tranh.</p><p>Thông thường, các ứng dụng streaming sử dụng Apache Kafka để thu nhận dữ liệu (data ingestion) và <a href=https://spark.apache.org/structured-streaming/>Apache Spark Structured Streaming</a> để xử lý.<br>Tuy nhiên, việc tích hợp và bảo mật các thành phần này đòi hỏi đa nhiều thách thức đáng kể cho người dùng.</p><p>Sự phức tạp trong việc quản lý chứng chỉ (certificates), keystore, và cấu hình TLS để kết nối Spark Streaming với Kafka brokers đôi khi đòi hỏi chuyên môn kỹ thuật cao.</p><p>Một nền tảng serverless được quản lý (managed serverless framework) sẽ giúp đơn giản hóa đáng kể quy trình này, loại bỏ nhu cầu cấu hình thủ công và giúp tích hợp liền mạch giữa các thành phần quan trọng.</p><p>Để đơn giản hóa việc quản lý và bảo mật trong kiến trúc streaming truyền thống, bạn có thể sử dụng <a href=https://aws.amazon.com/msk/>Amazon Managed Streaming for Apache Kafka</a> (Amazon MSK).</p><p>Dịch vụ được quản lý toàn phần (fully managed) này giúp đơn giản hóa quá trình thu nhận và xử lý dữ liệu.<br><a href=https://aws.amazon.com/msk/serverless/>Amazon MSK Serverless</a> loại bỏ nhu cầu quản lý cụm (cluster management)
và tự động mở rộng (scaling), đồng thời tăng cường bảo mật bằng cách tích hợp với <a href=https://aws.amazon.com/iam/>AWS Identity and Access Management</a> (IAM) để xác thực (authentication) và ủy quyền (authorization).</p><p>Cách tiếp cận hợp nhất này thay thế quy trình phức tạp trong quản lý chứng chỉ và khóa bảo mật được yêu cầu bởi xác thực client TLS (TLS client authentication) thông qua <a href=https://aws.amazon.com/certificate-manager/>AWS Certificate Manager</a>, giúp tinh gọn vận hành và nâng cao bảo vệ dữ liệu.</p><p>Ví dụ: khi một client cố gắng gửi dữ liệu vào cluster, MSK Serverless sẽ xác minh danh tính (identity) và quyền truy cập (permissions) của client thông qua IAM.</p><p>Để xử lý dữ liệu hiệu quả, bạn có thể sử dụng <a href=https://aws.amazon.com/emr/serverless/>Amazon EMR Serverless</a> cùng với ứng dụng Spark được xây dựng trên Spark Structured Streaming framework, cho phép xử lý dữ liệu gần thời gian thực (near real-time).<br>Cấu hình này giúp xử lý liền mạch các khối dữ liệu lớn từ MSK Serverless, sử dụng IAM authentication để đảm bảo tốc độ và bảo mật cao trong quá trình xử lý.</p><p>Bài viết này trình bày một giải pháp toàn diện đầu-cuối (end-to-end solution) để xử lý dữ liệu từ MSK Serverless bằng EMR Serverless Spark Streaming job, được bảo mật bằng IAM authentication.<br>Ngoài ra, bài viết còn minh họa cách truy vấn dữ liệu đã xử lý bằng <a href=https://aws.amazon.com/athena/>Amazon Athena</a>, mang đến quy trình xử lý và phân tích dữ liệu tích hợp, liền mạch.</p><p>Giải pháp này cho phép truy vấn dữ liệu gần thời gian thực (near real-time querying) của dữ liệu mới nhất được xử lý từ MSK Serverless và EMR Serverless thông qua Athena, mang lại phân tích và thông tin tức thời (instant insights & analytics).</p><h2 id=tổng-quan-giải-pháp>Tổng quan giải pháp</h2><p>Sơ đồ dưới đây minh họa kiến trúc (architecture) mà bạn sẽ triển khai trong bài viết này.
<img alt=architecture-diagram src=https://d2908q01vomqb2.cloudfront.net/b6692ea5df920cad691c20319a6fffd7a4a766b8/2025/05/26/blog-4406-image-1.png>
Quy trình làm việc bao gồm các bước sau:</p><ol><li><p>Kiến trúc bắt đầu với MSK Serverless cluster được cấu hình xác thực bằng IAM.<br>Một <a href=https://aws.amazon.com/ec2/>Amazon Elastic Compute Cloud</a> (Amazon EC2) instance chạy tập lệnh Python <code>producer.py</code> đóng vai trò là trình tạo dữ liệu (data producer), gửi dữ liệu mẫu đến Kafka topic trong cluster.</p></li><li><p>Spark Streaming job lấy dữ liệu từ Kafka topic, lưu trữ vào <a href=https://aws.amazon.com/s3/>Amazon Simple Storage Service</a> (Amazon S3) và tạo bảng tương ứng trong <a href=https://aws.amazon.com/glue/>AWS Glue Data Catalog</a>.<br>Trong quá trình tiêu thụ dữ liệu liên tục từ Kafka topic, job luôn cập nhật dữ liệu mới nhất.<br>Với checkpointing được bật, job theo dõi các bản ghi đã xử lý, cho phép tiếp tục từ điểm dừng trước đó trong trường hợp có sự cố, đảm bảo quá trình xử lý dữ liệu liền mạch.</p></li><li><p>Để phân tích dữ liệu, người dùng có thể sử dụng Athena — một dịch vụ truy vấn serverless. Athena cho phép thực hiện các truy vấn SQL tương tác trực tiếp trên dữ liệu trong Amazon S3, mà không cần quản lý cơ sở hạ tầng phức tạp.</p></li></ol><h2 id=điều-kiện-tiên-quyết>Điều kiện tiên quyết</h2><p>Trước khi bắt đầu, hãy đảm bảo rằng bạn đã có:</p><ul><li><p>Tài khoản AWS đang hoạt động với tính năng thanh toán (billing) được bật</p></li><li><p>Người dùng IAM có quyền administrator access (AdministratorAccess policy) hoặc các quyền cụ thể để tạo và quản lý các tài nguyên như: virtual private cloud (VPC), subnet, security group, IAM roles, NAT gateway, internet gateway, EC2 client, MSK Serverless, EMR Serverless, <a href=https://aws.amazon.com/emr/features/emr-studio/>Amazon EMR Studio</a> và S3 buckets</p></li><li><p>Dung lượng VPC (VPC capacity) đủ trong AWS Region bạn chọn</p></li></ul><p>Mặc dù việc sử dụng IAM user có administrator access sẽ hoạt động tốt,<br>nhưng khuyến nghị rằng trong môi trường production, bạn nên tuân theo nguyên tắc phân quyền tối thiểu (principle of least privilege) — bằng cách tạo custom IAM policies chỉ bao gồm các quyền cần thiết.<br>Người dùng IAM mà chúng ta tạo trong hướng dẫn này có gán AdministratorAccess policy, tuy nhiên bạn không nhất thiết cần quyền cao như vậy.</p><p>Đối với bài viết này, chúng ta sẽ tạo các tài nguyên của giải pháp trong Region <strong>us-east-2</strong>, sử dụng <a href=https://aws.amazon.com/cloudformation/>AWS CloudFormation</a> templates.<br>Trong các phần tiếp theo, chúng tôi sẽ hướng dẫn bạn cách cấu hình tài nguyên và triển khai giải pháp.</p><hr><h1 id=create-msk-serverless-and-emr-serverless-resources>Create MSK Serverless and EMR Serverless resources</h1><p>Stack <strong>vpc-msk-emr-serverless-studio.yaml</strong> sẽ tạo các tài nguyên sau:<br>VPC, subnet, security group, IAM roles, NAT gateway, internet gateway, EC2 client, MSK Serverless, EMR Serverless, EMR Studio, và S3 buckets.</p><p>Để tạo các tài nguyên cho giải pháp này, hãy thực hiện các bước sau:</p><ol><li><p><strong>Khởi chạy stack vpc-msk-emr-serverless-studio</strong> bằng CloudFormation template.<br><a href=https://signin.aws.amazon.com/>Amazon Web Services Sign-In</a></p></li><li><p><strong>Cung cấp các giá trị tham số (parameter values)</strong> như được liệt kê trong bảng sau.</p><table><thead><tr><th style=text-align:left>Parameters</th><th style=text-align:left>Description</th><th style=text-align:left>Sample value</th></tr></thead><tbody><tr><td style=text-align:left><strong>EnvironmentName</strong></td><td style=text-align:left>Tên môi trường được thêm làm tiền tố (prefix) cho các tên tài nguyên.</td><td style=text-align:left>msk-emr-serverless-pipeline</td></tr><tr><td style=text-align:left><strong>InstanceType</strong></td><td style=text-align:left>Loại EC2 instance dành cho <strong>Amazon MSK client</strong>.</td><td style=text-align:left>t2.micro</td></tr><tr><td style=text-align:left><strong>LatestAmiId</strong></td><td style=text-align:left>ID của <strong>Amazon Linux 2023 AMI</strong> mới nhất cho EC2 instance. Bạn có thể sử dụng giá trị mặc định.</td><td style=text-align:left>/aws/service/ami-amazon-linux-latest/al2023-ami-kernel-6.1-x86_64</td></tr><tr><td style=text-align:left><strong>VpcCIDR</strong></td><td style=text-align:left>Phạm vi địa chỉ IP (<strong>CIDR notation</strong>) cho VPC này.</td><td style=text-align:left>10.192.0.0/16</td></tr><tr><td style=text-align:left>Parameters</td><td style=text-align:left>Description</td><td style=text-align:left>Sample value</td></tr><tr><td style=text-align:left><strong>PublicSubnet1CIDR</strong></td><td style=text-align:left>Phạm vi địa chỉ IP (CIDR notation) cho <strong>public subnet</strong> trong <strong>Availability Zone đầu tiên</strong>.</td><td style=text-align:left>10.192.10.0/24</td></tr><tr><td style=text-align:left><strong>PublicSubnet2CIDR</strong></td><td style=text-align:left>Phạm vi địa chỉ IP (CIDR notation) cho <strong>public subnet</strong> trong <strong>Availability Zone thứ hai</strong>.</td><td style=text-align:left>10.192.11.0/24</td></tr><tr><td style=text-align:left><strong>PrivateSubnet1CIDR</strong></td><td style=text-align:left>Phạm vi địa chỉ IP (CIDR notation) cho <strong>private subnet</strong> trong <strong>Availability Zone đầu tiên</strong>.</td><td style=text-align:left>10.192.20.0/24</td></tr><tr><td style=text-align:left>Parameters</td><td style=text-align:left>Description</td><td style=text-align:left>Sample value</td></tr><tr><td style=text-align:left><strong>PrivateSubnet2CIDR</strong></td><td style=text-align:left>Phạm vi địa chỉ IP (CIDR notation) cho private subnet trong Availability Zone thứ hai.</td><td style=text-align:left>10.192.21.0/24</td></tr></tbody></table></li></ol><p>Quá trình tạo stack có thể mất khoảng 10 phút để hoàn tất.</p><p>Sau khi stack được tạo xong, bạn có thể kiểm tra thông tin trong tab Outputs<br>để xem các giá trị đầu ra (outputs) của stack.
<img alt=Outputs src=https://d2908q01vomqb2.cloudfront.net/b6692ea5df920cad691c20319a6fffd7a4a766b8/2025/05/26/blog-4406-image-4.jpg></p><p>Tiếp theo, bạn sẽ thiết lập quá trình thu nhận dữ liệu (data ingestion) vào Kafka topic từ Kafka EC2 instance</p><h2 id=produce-records-to-kafka-topic>Produce records to Kafka topic</h2><p>Thực hiện các bước sau để thiết lập data ingestion:</p><ol><li><p>Truy cập Amazon EC2 console, đến EC2 instance mà bạn đã tạo bằng CloudFormation template.</p><p><img alt="EC2 console" src=https://d2908q01vomqb2.cloudfront.net/b6692ea5df920cad691c20319a6fffd7a4a766b8/2025/05/26/blog-4406-image-5.jpeg></p></li><li><p>Đăng nhập vào EC2 instance bằng Session Manager, một tính năng của AWS Systems Manager.</p></li><li><p>Chọn instance có tên <strong>msk-emr-serverless-blog</strong>, sau đó chọn <strong>Connect</strong> để kết nối.</p><p><img alt="Session Manager" src=https://d2908q01vomqb2.cloudfront.net/b6692ea5df920cad691c20319a6fffd7a4a766b8/2025/05/26/blog-4406-image-6.jpg></p></li><li><p>Tạo <strong>Kafka topic</strong> trong <strong>MSK Serverless</strong> từ EC2 instance.</p></li></ol><p>a.Trong lệnh export sau, hãy thay thế my-endpoint bằng giá trị MSKBootstrapServers được hiển thị trong Outputs của CloudFormation stack:$ sudo su - ec2-user
$ BS=&lt;your-msk-serverless-endpoint (e.g.) boot-xxxxxx.yy.kafka-serverless.us-east-2.amazonaws.com:9098></p><p>b.Chạy lệnh sau trên EC2 instance để tạo một Kafka topic có tên sales_data_topic.</p><p>Kafka client đã được cài đặt sẵn trong thư mục /home/ec2-user của người dùng ec2-user, kèm theo MSK IAM Authentication JAR và tệp cấu hình client tại đường dẫn
/home/ec2-user/kafka_2.12-2.8.1/bin/client.properties — trong đó đã bao gồm các thuộc tính cấu hình IAM authentication.
Mã sau đây hiển thị nội dung của tệp client.properties:
security.protocol=SASL_SSL
sasl.mechanism=AWS_MSK_IAM
sasl.jaas.config=software.amazon.msk.auth.iam.IAMLoginModule required;
sasl.client.callback.handler.class=software.amazon.msk.auth.iam.IAMClientCallbackHandler</p><p>/home/ec2-user/kafka_2.12-2.8.1/bin/kafka-topics.sh<br>&ndash;bootstrap-server $BS<br>&ndash;command-config /home/ec2-user/kafka_2.12-2.8.1/bin/client.properties<br>&ndash;create &ndash;topic sales_data_topic<br>&ndash;partitions 10</p><p>Created topic sales_data_topic.</p><p>5.Chạy lệnh sau để gửi dữ liệu (produce records) vào Kafka topic bằng tập lệnh Python syntheticSalesDataProducer.py có sẵn trong EC2 instance.
Hãy cập nhật giá trị Region cho phù hợp với khu vực AWS bạn đang sử dụng.</p><p>nohup python3 -u syntheticSalesDataProducer.py &ndash;num_records 1000<br>&ndash;sales_data_topic sales_data_topic &ndash;bootstrap_server $BS<br>&ndash;region=us-east-2 > syntheticSalesDataProducer.log &</p><h2 id=tìm-hiểu-về-amazon-msk-iam-authentication-với-emr-serverless>Tìm hiểu về Amazon MSK IAM authentication với EMR Serverless</h2><p>Amazon MSK IAM authentication cho phép xác thực (authentication) và ủy quyền (authorization) an toàn cho các Kafka cluster (MSK Serverless) bằng cách sử dụng IAM roles.</p><p>Khi được tích hợp với EMR Serverless Spark Streaming, Amazon MSK IAM authentication cho phép các Spark job truy cập Kafka topics một cách an toàn, sử dụng IAM roles để kiểm soát quyền truy cập chi tiết (fine-grained access control). Điều này đảm bảo quy trình xử lý và truyền dữ liệu (data processing and streaming) được bảo mật cao.</p><hr><h2 id=cấu-hình-iam-policy>Cấu hình IAM policy</h2><p>Để cho phép EMR Serverless jobs xác thực với MSK Serverless cluster thông qua IAM, bạn cần gắn (attach) các quyền liên quan đến Kafka vào IAM role của EMR Serverless job execution.</p><p>Các quyền này cho phép job thực hiện những thao tác cần thiết trên Kafka cluster, Kafka topics, và consumer groups.</p><p>Chính sách IAM policy sau đây cần được gắn vào EMR Serverless job execution role để cung cấp các quyền cần thiết:</p><p>{
&ldquo;Version&rdquo;: &ldquo;2012-10-17&rdquo;,
&ldquo;Statement&rdquo;: [
{
&ldquo;Action&rdquo;: [
&ldquo;kafka-cluster:Connect&rdquo;,
&ldquo;kafka-cluster:DescribeCluster&rdquo;
],
&ldquo;Resource&rdquo;: [
&ldquo;arn:aws:kafka:<aws-region>:<accountid>:cluster/&lt;SERVERLESS_CLUSTER_NAME>/<id>&rdquo;
],
&ldquo;Effect&rdquo;: &ldquo;Allow&rdquo;
},
{
&ldquo;Action&rdquo;: [
&ldquo;kafka-cluster:CreateTopic&rdquo;,
&ldquo;kafka-cluster:DescribeTopic&rdquo;,
&ldquo;kafka-cluster:WriteData&rdquo;,
&ldquo;kafka-cluster:ReadData&rdquo;
],
&ldquo;Resource&rdquo;: [
&ldquo;arn:aws:kafka:<aws-region>:<accountid>:topic/&lt;SERVERLESS_CLUSTER_NAME>/<em>/</em>&rdquo;
],
&ldquo;Effect&rdquo;: &ldquo;Allow&rdquo;
},
{
&ldquo;Action&rdquo;: [
&ldquo;kafka-cluster:AlterGroup&rdquo;,
&ldquo;kafka-cluster:DescribeGroup&rdquo;
],
&ldquo;Resource&rdquo;: [
&ldquo;arn:aws:kafka:<aws-region>:<accountid>:group/&lt;SERVERLESS_CLUSTER_NAME>/<em>/</em>&rdquo;
],
&ldquo;Effect&rdquo;: &ldquo;Allow&rdquo;
}
]
}</p><p>Mã cấu hình trên liên quan đến các <strong>hành động (actions)</strong> sau:</p><ul><li><p><strong>Connect, DescribeCluster</strong> – Cần thiết để <strong>khởi tạo kết nối bảo mật</strong> và lấy thông tin metadata.</p></li><li><p><strong>DescribeTopic, ReadData, WriteData</strong> – Cho phép <strong>đọc và ghi dữ liệu</strong> (tiêu thụ và sản xuất dữ liệu).</p></li><li><p><strong>CreateTopic (tùy chọn)</strong> – Cho phép <strong>tạo topic động</strong> khi cần.</p></li><li><p><strong>AlterGroup, DescribeGroup</strong> – Cần thiết để <strong>quản lý consumer group</strong> trong các <strong>streaming jobs</strong>.</p></li></ul><p>Các quyền này đảm bảo rằng Spark Streaming job có thể <strong>xác thực (authenticate)</strong> và tương tác an toàn với MSK Serverless resources bằng IAM role của nó.</p><hr><h2 id=các-thư-viện-phụ-thuộc-cần-thiết>Các thư viện phụ thuộc cần thiết</h2><p>Để bật Amazon MSK IAM authentication trong Spark (đặc biệt là trên EMR Serverless), bạn cần bao gồm các JAR phụ thuộc sau trong Spark Streaming job thông qua tham số <strong>sparkSubmitParameters</strong>:</p><ul><li><p><a href=https://mvnrepository.com/artifact/org.apache.spark/spark-sql-kafka-0-10_2.12>spark-sql-kafka-0-10_2.12</a> – Trình Kafka connector cho Spark Structured Streaming. Cung cấp DataFrame API để đọc và ghi dữ liệu từ/đến Kafka.</p></li><li><p><a href=https://mvnrepository.com/artifact/software.amazon.msk/aws-msk-iam-auth>aws-msk-iam-auth</a> – JAR này cung cấp cơ chế xác thực IAM cần thiết để kết nối với MSK Serverless thông qua cơ chế <strong>AWS_MSK_IAM SASL mechanism</strong>.</p></li></ul><p>Bạn có thể thêm trực tiếp các thư viện phụ thuộc này bằng cách chỉ định chúng trong đối số <strong>&ndash;packages</strong> khi gửi EMR Serverless job.<br>Ví dụ:
packages org.apache.spark:spark-sql-kafka-0-10_2.12:3.5.1,software.amazon.msk:aws-msk-iam-auth:2.2.0</p><p>Khi job được gửi đi, EMR Serverless sẽ tự động tải xuống các JAR này từ Maven Central (hoặc từ kho lưu trữ khác mà bạn đã cấu hình) trong quá trình chạy (runtime).<br>Bạn không cần gói (bundle) thủ công các JAR này, trừ khi bạn cần sử dụng ngoại tuyến (offline) hoặc yêu cầu phiên bản cụ thể.</p><h2 id=cấu-hình-spark-streaming-job-cho-amazon-msk-iam-authentication>Cấu hình Spark Streaming job cho Amazon MSK IAM authentication</h2><p>Trong ứng dụng Spark Streaming của bạn, hãy cấu hình Kafka source với các thuộc tính SASL để kích hoạt IAM-based authentication.<br>Đoạn mã sau minh họa cấu hình cần thiết:</p><p>topic_df = (spark.readStream
.format(&ldquo;kafka&rdquo;)
.option(&ldquo;kafka.bootstrap.servers&rdquo;, kafka_bootstrap_servers)
.option(&ldquo;subscribe&rdquo;, topic_input)
.option(&ldquo;startingOffsets&rdquo;, &ldquo;earliest&rdquo;)
.option(&ldquo;kafka.security.protocol&rdquo;,&ldquo;SASL_SSL&rdquo;)
option(&ldquo;kafka.sasl.mechanism&rdquo;,&ldquo;AWS_MSK_IAM&rdquo;)
.option(&ldquo;kafka.sasl.jaas.config&rdquo;,&ldquo;software.amazon.msk.auth.iam.IAMLoginModule required;&rdquo;)
.option(&ldquo;kafka.sasl.client.callback.handler.class&rdquo;,&ldquo;software.amazon.msk.auth.iam.IAMClientCallbackHandler&rdquo;)
.load()
.selectExpr(&ldquo;CAST(value AS STRING)&rdquo;)
)</p><p>Các thuộc tính chính bao gồm:</p><ul><li><p><strong>kafka.security.protocol = SASL_SSL</strong> – Kích hoạt truyền thông mã hóa (encrypted communication) qua SSL với SASL authentication.</p></li><li><p><strong>kafka.sasl.mechanism = AWS_MSK_IAM</strong> – Chỉ định Kafka sử dụng cơ chế xác thực dựa trên IAM (IAM-based SASL mechanism).</p></li><li><p><strong>kafka.sasl.jaas.config = software.amazon.msk.auth.iam.IAMLoginModule required;</strong><br>– Xác định module đăng nhập (login module) do AWS cung cấp để tích hợp IAM.</p></li><li><p><strong>kafka.sasl.client.callback.handler.class = software.amazon.msk.auth.iam.IAMClientCallbackHandler</strong><br>– Xử lý việc ký và xác thực thực tế bằng IAM role.
Với các thiết lập này, Spark sẽ sử dụng IAM credentials được gán với EMR Serverless job execution role để xác thực với MSK Serverless, mà không cần thêm bất kỳ credentials, chứng chỉ (certificates) hoặc bí mật (secrets) nào khác.</p></li></ul><hr><h2 id=xử-lý-dữ-liệu-bằng-emr-serverless-streaming-job-với-amazon-msk-iam-authentication>Xử lý dữ liệu bằng EMR Serverless streaming job với Amazon MSK IAM authentication</h2><p>Thực hiện các bước sau để chạy Spark Streaming job nhằm xử lý dữ liệu từ MSK Serverless:</p><ol><li><p>Gửi (submit) Spark Streaming job đến EMR Serverless bằng AWS Command Line Interface (AWS CLI) — công cụ này đã được cài sẵn trên EC2 instance.</p></li><li><p>Đăng nhập vào EC2 instance bằng Session Manager.</p><ul><li>Chọn instance có tên <strong>msk-emr-serverless-blog</strong>, sau đó chọn <strong>Connect</strong>.</li></ul></li><li><p>Chạy lệnh sau để gửi (submit) streaming job.</p><ul><li>Cung cấp các tham số (parameters) lấy từ CloudFormation stack output.</li></ul></li></ol><p>sudo su - ec2-user</p><p>aws emr-serverless start-job-run<br>&ndash;application-id <application id><br>&ndash;execution-role-arn <execution role arn><br>&ndash;mode &lsquo;STREAMING&rsquo;<br>&ndash;job-driver &lsquo;{
&ldquo;sparkSubmit&rdquo;: {
&ldquo;entryPoint&rdquo;: &ldquo;s3://<emr blog script bucket>/emr_pyspark_streaming_script/pysparkStreamingBlog.py&rdquo;,
&ldquo;entryPointArguments&rdquo;:["&ndash;topic_input",&ldquo;sales_data_topic&rdquo;,"&ndash;kafka_bootstrap_servers","<bootstrap url with port>","&ndash;output_s3_path",&ldquo;s3://<emr streaming output bucket>/output/sales-order-data/&rdquo;,"&ndash;checkpointLocation",&ldquo;s3://<emr streaming output bucket>/checkpointing/checkpoint-sales-order-data/&rdquo;,"&ndash;database_name",&ldquo;emrblog&rdquo;,"&ndash;table_name",&ldquo;sales_order_data&rdquo;],
&ldquo;sparkSubmitParameters&rdquo;: &ldquo;&ndash;conf spark.hadoop.hive.metastore.client.factory.class=com.amazonaws.glue.catalog.metastore.AWSGlueDataCatalogHiveClientFactory &ndash;conf spark.executor.cores=2 &ndash;conf spark.executor.memory=5g &ndash;conf spark.driver.cores=2 &ndash;conf spark.driver.memory=5g &ndash;conf spark.executor.instances=5 &ndash;packages org.apache.spark:spark-sql-kafka-0-10_2.12:3.5.1,software.amazon.msk:aws-msk-iam-auth:2.2.0&rdquo;
}}&rsquo;
4. Sau khi bạn gửi (submit) job, hãy đăng nhập vào EMR Studio bằng URL được hiển thị trong giá trị <strong>EmrServerlessStudioURL</strong> từ CloudFormation stack output.</p><ol start=5><li><p>Trong thanh điều hướng (navigation pane), chọn <strong>Applications</strong> trong phần Serverless.</p></li><li><p>Chọn application ID tương ứng với giá trị<br><strong>EmrServerlessSparkApplicationID</strong> từ CloudFormation stack output.</p></li><li><p>Trong tab <strong>Streaming job runs</strong>, xác minh rằng job đã được gửi thành công, và chờ cho đến khi job bắt đầu chạy.</p></li></ol><p><img alt="Streaming job runs screenshot" src=https://d2908q01vomqb2.cloudfront.net/b6692ea5df920cad691c20319a6fffd7a4a766b8/2025/05/26/blog-4406-image-7.jpeg></p><hr><h2 id=xác-thực-dữ-liệu-trong-athena>Xác thực dữ liệu trong Athena</h2><p>Sau khi EMR Serverless Spark Streaming job đã chạy và tạo bảng dữ liệu đã xử lý (processed data table) trong Data Catalog, hãy thực hiện các bước sau để xác thực dữ liệu bằng Athena:</p><ol><li><p>Mở Athena console, truy cập query editor.</p></li><li><p>Chọn Data Catalog làm nguồn dữ liệu (data source).</p></li><li><p>Chọn database <strong>emrblog</strong> — được tạo bởi streaming job.</p></li><li><p>Để xác thực dữ liệu, chạy truy vấn (query) sau:</p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>    DATE_TRUNC(<span style=color:#e6db74>&#39;minute&#39;</span>, date) <span style=color:#66d9ef>AS</span> minute_window,
</span></span><span style=display:flex><span>    ROUND(<span style=color:#66d9ef>SUM</span>(total_amount), <span style=color:#ae81ff>2</span>) <span style=color:#66d9ef>AS</span> total_amount
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span>
</span></span><span style=display:flex><span>    emrblog.sales_order_data
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span>
</span></span><span style=display:flex><span>    DATE_TRUNC(<span style=color:#e6db74>&#39;day&#39;</span>, date) <span style=color:#f92672>=</span> <span style=color:#66d9ef>CURRENT_DATE</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span>
</span></span><span style=display:flex><span>    DATE_TRUNC(<span style=color:#e6db74>&#39;minute&#39;</span>, date)
</span></span><span style=display:flex><span><span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span>  
</span></span><span style=display:flex><span>    minute_window <span style=color:#66d9ef>DESC</span>;
</span></span></code></pre></div><p><img alt=athena-query-result src=https://d2908q01vomqb2.cloudfront.net/b6692ea5df920cad691c20319a6fffd7a4a766b8/2025/05/26/blog-4406-image-8.jpg></p><h2 id=clean-up>Clean up</h2><p>Để xóa các tài nguyên và tránh phát sinh chi phí, hãy thực hiện các bước sau:</p><ol><li><p><strong>Đăng nhập vào EMR Studio</strong> bằng URL được hiển thị trong giá trị<br><strong>EmrServerlessStudioURL</strong> của CloudFormation stack output.</p></li><li><p>Trong <strong>thanh điều hướng (navigation pane)</strong>, chọn <strong>Applications</strong> trong phần Serverless.</p></li><li><p>Chọn <strong>application ID</strong> tương ứng với giá trị<br><strong>EmrServerlessSparkApplicationID</strong> trong CloudFormation stack output.</p></li><li><p>Trong tab <strong>Streaming job runs</strong>, chọn job đang chạy và <strong>hủy (cancel)</strong> job đó.</p></li><li><p>Truy cập <strong>AWS CloudFormation console</strong> và xóa stack có tên<br><strong>vpc-msk-emr-serverless-studio</strong>.</p></li></ol><hr><h2 id=conclusion>Conclusion</h2><p>Trong bài viết này, chúng tôi đã trình bày một pipeline serverless để xử lý dữ liệu streaming với IAM authentication, giúp bạn tập trung vào việc khai thác thông tin phân tích (analytics insights) thay vì quản lý hạ tầng phức tạp.</p><p>Bạn có thể tùy chỉnh mã Spark Streaming trong EMR Serverless để áp dụng các chuyển đổi (transformations) và bộ lọc (filters), đảm bảo rằng dữ liệu hợp lệ được tải vào Amazon S3.</p><p>Giải pháp này kết hợp sức mạnh của Amazon EMR Serverless Spark Streaming và MSK Serverless, được tích hợp an toàn thông qua IAM authentication — cho phép bạn đơn giản hóa quy trình streaming mà không cần lo về việc quản lý tích hợp giữa Amazon MSK và Amazon EMR Spark Streaming.</p><hr><h2 id=về-các-tác-giả>Về các tác giả</h2><p><img alt=shubham-purwar src=https://d2908q01vomqb2.cloudfront.net/b6692ea5df920cad691c20319a6fffd7a4a766b8/2023/09/06/shubham-100.jpeg></p><p><strong>Shubham Purwar</strong> là AWS Analytics Specialist Solution Architect.<br>Anh hỗ trợ các tổ chức khai thác tối đa tiềm năng dữ liệu của họ bằng cách thiết kế và triển khai các giải pháp phân tích (analytics solutions) có khả năng mở rộng (scalable), bảo mật (secure) và hiệu năng cao (high-performance) trên nền tảng AWS.<br>Với kiến thức chuyên sâu về các dịch vụ phân tích của AWS, Shubham hợp tác chặt chẽ với khách hàng để hiểu rõ yêu cầu kinh doanh riêng biệt và xây dựng các giải pháp tùy chỉnh (customized solutions) mang lại thông tin có thể hành động (actionable insights), góp phần thúc đẩy tăng trưởng doanh nghiệp.<br>Trong thời gian rảnh, Shubham thích dành thời gian cho gia đình và du lịch khắp thế giới.</p><p><img alt=nitin-kumar src=https://d2908q01vomqb2.cloudfront.net/b6692ea5df920cad691c20319a6fffd7a4a766b8/2025/05/26/Nitinnew-100x111.jpg></p><p><strong>Nitin Kumar</strong> là Cloud Engineer (ETL) tại AWS, chuyên về AWS Glue.<br>Với hơn 10 năm kinh nghiệm, anh có thể mạnh trong việc hỗ trợ khách hàng xử lý khối lượng dữ liệu lớn (big data workloads), tập trung vào xử lý dữ liệu (data processing) và phân tích dữ liệu (analytics).<br>Anh luôn tận tâm giúp khách hàng vượt qua các thách thức liên quan đến ETL, đồng thời xây dựng các pipeline xử lý và phân tích dữ liệu có khả năng mở rộng (scalable) trên AWS.<br>Trong thời gian rảnh, Nitin thích xem phim, nấu ăn và dành thời gian cho gia đình.
<img alt=prashanthi-chinthala src=https://d2908q01vomqb2.cloudfront.net/b6692ea5df920cad691c20319a6fffd7a4a766b8/2025/05/26/WhatsApp-Image-2025-05-23-at-9.40.42-PM-100x103.jpeg></p><p><strong>Prashanthi Chinthala</strong> là Cloud Engineer (DIST) tại AWS.<br>Cô hỗ trợ khách hàng giải quyết các thách thức liên quan đến Amazon EMR và xây dựng các pipeline xử lý và phân tích dữ liệu (data processing & analytics pipelines) có khả năng mở rộng (scalable) trên nền tảng AWS.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=../../../vi/3-blogstranslated/3.2-blog2/ title="Blog 2"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=../../../vi/4-eventparticipated/ title="Các sự kiện đã tham gia" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=../../../js/clipboard.min.js?1765252493></script><script src=../../../js/perfect-scrollbar.min.js?1765252493></script><script src=../../../js/perfect-scrollbar.jquery.min.js?1765252493></script><script src=../../../js/jquery.sticky.js?1765252493></script><script src=../../../js/featherlight.min.js?1765252493></script><script src=../../../js/highlight.pack.js?1765252493></script><script>hljs.initHighlightingOnLoad()</script><script src=../../../js/modernizr.custom-3.6.0.js?1765252493></script><script src=../../../js/learn.js?1765252493></script><script src=../../../js/hugo-learn.js?1765252493></script><link href=../../../mermaid/mermaid.css?1765252493 rel=stylesheet><script src=../../../mermaid/mermaid.js?1765252493></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,(e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date),(i=t.createElement(n),a=t.getElementsByTagName(n)[0]),i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>